jstackClass=function(){this.config={templatesPath:"view-js/",controllersPath:"controller-js/",defaultController:{},debug:$js.dev},this.controllers={}},jstackClass.prototype.extend=function(a,b){a.prototype=Object.create(b.prototype)},jstack=new jstackClass,function(){let a="__JSTACK__OBSERVABLE__";var b=function(c,d,e){let f=c[a];if(f)return f.parentKey=e,f.parentProxy=d,c;let g=function(b,c){if($.each(f.namespaces,function(a,d){if(!c[a]){b.preventImmediatePropagation=!1,b.stopPropagation=function(){c[a]=!0},b.stopImmediatePropagation=function(){b.preventImmediatePropagation=!0,c[a]=!0};for(let e=0,f=d.length;e<f;e++){let a=d[e];if((a.recursive||!b.keyStack.length)&&(a.key===!1||a.key===b.key)){let c=a.callback(b);if(c===!1||b.preventImmediatePropagation)return}}}}),f.parentProxy){let d=f.parentProxy[a],e=$.extend({},b);e.keyStack.push(f.parentKey),d.notify(e,c)}};f={namespaces:{},parentProxy:d,parentKey:e,notify:g,proxyTarget:c};let h;return h=new Proxy(c,{get:function(b,c){return c===a?f:b[c]},set:function(a,c,d){let e=a[c];return"object"==typeof d&&null!==d&&(d=b(d,h,c)),a[c]=d,g({type:"set",target:a,keyStack:[],key:c,oldValue:e,value:d},{}),!0},deleteProperty:function(b,c){let d=b[c];if(Array.isArray(b)?b.splice(c,1):delete b[c],"object"==typeof d&&null!==d){let b=d[a];b.parentProxy===h&&b.parentKey===c&&(delete b.parentProxy,delete b.parentKey)}return g({type:"unset",target:b,keyStack:[],key:c,oldValue:d},{}),!0},ownKeys:function(a){return Reflect.ownKeys(a)}}),$.each(c,function(a,d){"object"==typeof d&&null!==d&&(c[a]=b(d,h,a))}),h},c=function(b,c,d,e,f){"function"==typeof c&&(f=e,e=d,d=c,c=!1),c!==!1&&"string"!=typeof c&&"number"!=typeof c||(c=[c]),e||(e=0);let g=b[a];if(!g)throw new Error("object is not observable");g.namespaces[e]||(g.namespaces[e]=[]);let h=g.namespaces[e];for(let i=0,j=c.length;i<j;i++)h.push({key:c[i],callback:d,recursive:f})};let d=function(b,c,e,f){if(c instanceof Array)for(let g=0,h=c.length;g<h;g++)d(b,c[g],e,f);else{"function"==typeof c&&(f=e,e=c,c=!1),f||(f=0);let d=b[a];if(!d)throw new Error("object is not observable");let g=d.namespaces[f];if(g)if(c||e)for(let h=0,i=g.length;h<i;h++){let a=g[h];c!==a.key||e&&e!==a.callback||g.splice(h,1)}else g.length=0}},e=function(b){let c=b,d=b[a];return d&&(c=d.proxyTarget),c};jstack.observable=b,jstack.observe=c,jstack.unobserve=d,jstack.getObserverTarget=e}(),function(){var a=function(a,b,c){var d=this,e=b.data("jModel")||{};if(b[0].hasAttribute("j-view-inherit")){var f=b.parent().closest("[j-controller]");if(f.length&&b[0].hasAttribute("j-view-inherit")){var g=b[0].getAttribute("j-view-inherit"),h=f.data("jModel")||{};g?e[g]=h:e=$.extend({},h,e)}}var i={domReady:function(){},setData:function(){}};$.extend(!0,this,i,a),this.element=b,this.hash=c,this.data=e,b.data("jController",this),this.startDataObserver=function(){d.data;d.data=d.data.observable(),d.dataBinder=new jstack.dataBinder(d.data,d.element[0],d),d.dataBinder.eventListener(),d.data.observe(function(a){d.dataBinder.update()},"jstack.model",!0)},this.setDataArguments=[],this.setDataCall=function(){var a=this.setData.apply(this,this.setDataArguments);0==a?this.noRender=!0:"object"==$.type(a)&&a!==ctrl.data&&$.extend(this.data,a),this.startDataObserver()},this.render=function(a){if(!this.noRender){var b=this.element;b.data("jModel",this.data),b[0].setAttribute("j-controller",this.name),a=d.dataBinder.compileHTML(a),Boolean(b[0].getAttribute("j-view-append"))?b.append(a):b.html(a);var c=$.Deferred();return this.dataBinder.ready(function(){d.domReady(),c.resolve()}),c}}};jstack.controller=function(b,c,d){if("object"==typeof b){if(b.extend){b.dependencies||(b.dependencies=[]);var e=$.Deferred();b.dependencies.push(e);var f=jstack.config.controllersPath+b.extend;$js.require(f),$js(f,function(){$.each(jstack.controllers[b.extend],function(a,c){switch(a){case"dependencies":c instanceof Array&&c.forEach(function(a){b.dependencies.push(a)});break;default:void 0===b[a]&&(b[a]=c)}}),e.resolve()})}if(b.mixins)for(var g=0,h=mixins.length;g<h;g++)$.each(mixins[g],function(a,c){void 0===b[a]&&(b[a]=c)});return jstack.controllers[b.name]=b,jstack.controllers[b.name]}if(!d){var i=c.parent().closest("[j-controller]");i.length&&(d=i.data("jController").hash),d||(d=window.location.hash)}var j=jstack.controllers[b]||jstack.controller($.extend(!0,{name:b},jstack.config.defaultController)),k=(j.name,$.Deferred()),l=[];if(j.dependencies&&j.dependencies.length){var m=$.Deferred();$js(j.dependencies,function(){m.resolve()}),l.push(m)}return $.when.apply($,l).then(function(){var b=new a(j,c,d),e=[],f=b.dependenciesData;if(f&&("function"==typeof f&&(b.dependenciesData=f=b.dependenciesData()),f&&f.length)){for(var g=[],h=0,i=f.length;h<i;h++){var l=f[h];if("function"==typeof l&&(l=l.call(b)),"object"==$.type(l)&&"abort"in l){var m=l;l=$.Deferred(),function(a){m.then(function(b){a.resolve(b)})}(l)}if(!("object"==$.type(l)&&"then"in l)){var m=l;l=$.Deferred(),l.resolve(m)}g.push(l)}var n=$.when.apply($,g).then(function(){for(var a=0,c=arguments.length;a<c;a++)b.setDataArguments.push(arguments[a])});e.push(n)}$.when.apply($,e).then(function(){b.setDataCall(),k.resolve(b)})}),k.promise()}}(),jstack.url=function(){var Url=function(){},recursiveArrayToObject=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(a[c]instanceof Array?b[c]=recursiveArrayToObject(a[c]):b[c]=a[c]);return b};return Url.prototype.params=new Array,Url.prototype.getQuery=function(a){var b=a,c=b.indexOf("?");return c==-1?"":(b=b.substr(c+1,b.length),c=b.indexOf("#"),c==-1?b:b.substr(0,c))},Url.prototype.getPath=function(a){var b=a.indexOf("?");return b==-1?a:a.substr(0,b)},Url.prototype.buildParamFromString=function(param){var p=decodeURIComponent(param),strpos=p.indexOf("=");if(strpos==-1)return""!==p&&(this.params[p]="",this.params.length++),!0;var name=p.substr(0,strpos),value=p.substr(strpos+1,p.length),openBracket=name.indexOf("["),closeBracket=name.indexOf("]");if(openBracket==-1||closeBracket==-1)return openBracket==-1&&closeBracket==-1||(name=name.replace(new RegExp("[\\[\\]]"),"_")),this.params[name]=value,!0;var matches=name.match(new RegExp("\\[.*?\\]","g"));name=name.substr(0,openBracket),p="this.params";var key=name;for(var i in matches)matches.hasOwnProperty(i)&&(p+="['"+key+"']",void 0!=eval(p)&&"object"==typeof eval(p)||eval(p+"= new Array();"),""==(key=matches[i].substr(1,matches[i].length-2))&&(key=eval(p).length));p+="['"+key+"']",eval(p+"= '"+value+"';")},Url.prototype.parseQuery=function(a){var b=a;b=b.replace(new RegExp("&"),"&"),this.params=new Array,this.params.length=0,b=b.split("&");for(var c=0;c<b.length;c++)this.buildParamFromString(b[c]);return recursiveArrayToObject(this.params)},Url.prototype.buildStringFromParam=function(a,b){var c="",d="";if(void 0!=b&&(c=b),"object"==typeof a)for(var e in a)d=a[e],e=""==c?e:"["+e+"]","object"==typeof d?this.buildStringFromParam(d,c+e):this.params[this.params.length]=c+e+"="+d},Url.prototype.buildQuery=function(a){return this.params=new Array,this.buildStringFromParam(a),this.params.join("&")},Url.prototype.getParams=function(a){return this.parseQuery(this.getQuery(a))},Url.prototype.getParamsFromHash=function(){return this.getParams(document.location.hash)},new Url}(),jstack.uniqid=function(a,b){void 0===a&&(a="");var c,d=function(a,b){return a=parseInt(a,10).toString(16),b<a.length?a.slice(a.length-b):b>a.length?Array(b-a.length+1).join("0")+a:a};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed++,c=a,c+=d(parseInt((new Date).getTime()/1e3,10),8),c+=d(this.php_js.uniqidSeed,5),b&&(c+=(10*Math.random()).toFixed(8).toString()),c},jstack.isPositiveInteger=function(a){return 0==a%(!isNaN(parseFloat(a))&&0<=~~a)},jstack.isIntKey=function(a){return a>>>0===parseFloat(a)},jstack.arrayRemove=function(a,b,c){var d=a.slice((c||b)+1||a.length);return a.length=b<0?a.length+b:b,Array.prototype.push.apply(a,d)},jstack.flatObservable=function(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b];d=JSON.parse(JSON.stringify(d)),a.push(d)}return a},jstack.log=function(){console.log((new Error).stack.split("\n")[1]);var a=jstack.flatObservable.apply(jstack,arguments);console.log.apply(console,a)},jstack.randomColor=function(){return"#"+Math.random().toString(16).substr(2,6)},jstack.fragmentToHTML=function(a){var b=document.createElement("div");return b.appendChild(document.importNode(a.content,!0)),b.innerHTML},function(){var a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;jstack.isMobile=function(b){return b||(b=navigator.userAgent),a.test()}}(),function(){function a(a,b){var c=[" ","\n","\r","\t","\f","\v"," "," "," "," "," "," "," "," "," "," "," "," ","​","\u2028","\u2029","　"].join(""),d=0,e=0;for(a+="",b&&(c=(b+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^:])/g,"$1")),d=a.length,e=0;e<d;e++)if(c.indexOf(a.charAt(e))===-1){a=a.substring(e);break}for(d=a.length,e=d-1;e>=0;e--)if(c.indexOf(a.charAt(e))===-1){a=a.substring(0,e+1);break}return c.indexOf(a.charAt(0))===-1?a:""}function b(a,b){b=b?(b+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^:])/g,"$1"):" \\s ";var c=new RegExp("^["+b+"]+","g");return(a+"").replace(c,"")}function c(a,b){b=b?(b+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^:])/g,"\\$1"):" \\s ";var c=new RegExp("["+b+"]+$","g");return(a+"").replace(c,"")}String.prototype.trim||Object.defineProperty(String.prototype,"trim",{value:function(b){return a(this,b)},enumerable:!1}),String.prototype.ltrim||Object.defineProperty(String.prototype,"ltrim",{value:function(a){return b(this,a)},enumerable:!1}),String.prototype.rtrim||Object.defineProperty(String.prototype,"rtrim",{value:function(a){return c(this,a)},enumerable:!1}),String.prototype.escapeRegExp||Object.defineProperty(String.prototype,"escapeRegExp",{value:function(){return this.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},enumerable:!1}),String.prototype.replaceAllRegExp||Object.defineProperty(String.prototype,"replaceAllRegExp",{value:function(a,b){return this.replace(new RegExp(a,"g"),b)},enumerable:!1}),String.prototype.replaceAll||Object.defineProperty(String.prototype,"replaceAll",{value:function(a,b){return a=a.escapeRegExp(),this.replaceAllRegExp(a,b)},enumerable:!1}),String.prototype.camelCase||Object.defineProperty(String.prototype,"camelCase",{value:function(){return this.replace(/(\_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})},enumerable:!1}),String.prototype.camelCaseDash||Object.defineProperty(String.prototype,"camelCaseDash",{value:function(){return this.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})},enumerable:!1}),String.prototype.snakeCase||Object.defineProperty(String.prototype,"snakeCase",{value:function(){return this.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})},enumerable:!1}),String.prototype.snakeCaseDash||Object.defineProperty(String.prototype,"snakeCaseDash",{value:function(){return this.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},enumerable:!1}),String.prototype.ucfirst||Object.defineProperty(String.prototype,"ucfirst",{value:function(){return this.charAt(0).toUpperCase()+this.substr(1)},enumerable:!1}),String.prototype.lcfirst||Object.defineProperty(String.prototype,"lcfirst",{value:function(){return this.charAt(0).toLowerCase()+this.substr(1)},enumerable:!1})}(),Object.prototype.observable||Object.defineProperty(Object.prototype,"observable",{value:function(a){return jstack.observable(this,a)},enumerable:!1}),Object.prototype.observe||Object.defineProperty(Object.prototype,"observe",{value:function(a,b,c,d){return jstack.observe(this,a,b,c,d)},enumerable:!1}),Object.prototype.unobserve||Object.defineProperty(Object.prototype,"unobserve",{value:function(a,b,c,d){return jstack.unobserve(this,a,b,c,d)},enumerable:!1}),jstack.reflection={},jstack.reflection.arguments=function(f){var args=f.toString().match(/^\s*function\s+(?:\w*\s*)?\((.*?)\)\s*{/),r={};if(args&&args[1]){args=args[1],args=args.replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,""),args=args.trim().split(/\s*,\s*/);for(var i=0;i<args.length;i++){var arg=args[i],idf=arg.indexOf("=");idf===-1?r[arg]=void 0:r[arg.substr(0,idf)]=eval(arg.substr(idf+1).trim())}}return r},jstack.reflection.isCyclic=function(a){function b(a,g){if("object"==typeof a){if(e.has(a)){var h=d.indexOf(a),i=c.join(".")+"."+g,j=c.slice(0,h+1).join(".");return console.log("CIRCULAR: "+i+" = "+j+" = "+a),console.log(a),void(f=!0)}c.push(g),d.push(a),e.add(a);for(var k in a)a.hasOwnProperty(k)&&b(a[k],k);c.pop(),d.pop(),e.delete(a)}}var c=[],d=[],e=new Set,f=!1;return b(a,"obj"),f},jstack.traverseDomBreak={DESC:2,ASC:4,ADJ:8,BOTH:6,ALL:14},jstack.traverseDom=function(a,b,c){var d;if(c||(d=b(a)),c||!(d&jstack.traverseDomBreak.DESC))for(var e=a.childNodes,f=0;f<e.length;f++)if(e[f]){var g=this.traverseDom(e[f],b);if(g&jstack.traverseDomBreak.ASC&&(d|=g),g&jstack.traverseDomBreak.ADJ)break}return!c||d&jstack.traverseDomBreak.ASC||(d=b(a)),d},jstack.walkTheDOM=function(a,b){if(b(a)!==!1)for(var c=a.childNodes,d=0;d<c.length;d++)c[d]&&this.walkTheDOM(c[d],b)},$.arrayCompare=function(a,b){return 0===$(a).not(b).get().length&&0===$(b).not(a).get().length},$.fn.attrStartsWith=function(a){var b={};return this.each(function(c){$.each(this.attributes,function(c,d){0===d.name.indexOf(a)&&(b[d.name]=d.value)})}),b},$.attrsToObject=function(a,b,c){c||(c={});var d=a.split("--");void 0===c&&(c={});var e=c,f=d.length-1;return $.each(d,function(a,c){c=$.camelCase(c),a==f?e[c]=b:(e[c]||(e[c]={}),e=e[c])}),c},$.fn.changeVal=function(a){return $(this).val(a).trigger("change")},$.fn.childrenHeight=function(a,b,c){var d=bottomOffset=0;void 0===a&&(a=!0),void 0===b&&(b=!0),void 0===c&&(c=!0);var e=this.children();return c&&(e=e.filter(":visible")),e.each(function(c,e){var f=$(e),g=f.offset().top,h=g+(a?f.outerHeight(b):f.height());g<d&&(d=g),h>bottomOffset&&(bottomOffset=h)}),bottomOffset-d-this.offset().top},$.fn.dataAttrConfig=function(a){a||(a="data-");var b=a.length,c=this.attrStartsWith(a),d={};return $.each(c,function(a,c){$.attrsToObject(a.substr(b),c,d)}),d},$.fn.findExclude=function(a,b,c){var d=$([]);return $(this).each(function(e,f){$(f).find(a).each(function(a,e){var g=$(e);c&&(g=g.parent());var h=g.closest(b);h[0]!=f&&h.length||(d=d.add(e))})}),d},$.fn.hasHorizontalScrollBar=function(){return!!this.get(0)&&this.get(0).scrollWidth>this.innerWidth()},$.fn.hasVerticalScrollBar=function(){return!!this.get(0)&&this.get(0).scrollHeight>this.innerHeight()},function(){var a={"nth-level":function(a,b){b=parseInt(b,10);var c=[],d=this;return this.each(function(){$(this).parents(a).length;d.find(a).each(function(){$(this).parents(a).length==b-1&&c.push(this)})}),$(c)}};$.fn.findOrig=$.fn.find,$.fn.find=function(b){if("string"==typeof b){var c,d=this;if($.each(a,function(e,f){var g=b.indexOf(":"+e);if(g!==-1){var h=e.length,i=b.substr(0,g),j=b.substr(g+h+2,b.length-g-h-3);return c=a[e].call(d,i,j),!1}}),c)return c}return this.findOrig(b)}}(),$.on=function(a,b,c){return $(document).on(a,b,c)},$.off=function(a,b,c){return $(document).off(a,b,c)},$.one=function(a,b,c){return $(document).one(a,b,c)},$.extend($.expr[":"],{scrollable:function(a){return"scroll"==$(a).css("overflow")||"scroll"==$(a).css("overflowX")||"scroll"==$(a).css("overflowY")||(a.clientHeight<a.scrollHeight&&($.inArray($(a).css("overflowY"),["scroll","auto"])!=-1||$.inArray($(a).css("overflow"),["scroll","auto"])!=-1)||a.clientWidth<a.scrollWidth&&($.inArray($(a).css("overflowX"),["scroll","auto"])!=-1||$.inArray($(a).css("overflow"),["scroll","auto"])!=-1))},parents:function(a,b,c){return $(a).parents(c[3]).length<1},attrStartsWith:function(a,b,c){for(var d=0,e=a.attributes,f=e.length;d<f;d++)if(0===e[d].nodeName.toLowerCase().indexOf(c[3].toLowerCase()))return!0;return!1},attrEndsWith:function(a,b,c){for(var d=0,e=a.attributes,f=e.length;d<f;d++){var g=e[d].nodeName.toLowerCase(),h=c[3].toLowerCase();if(g.length>=h.length&&g.substr(g.length-h.length)===h)return!0}return!1},data:function(a,b,c){return!!$.data(a,c[3])}}),$.fn.removeClassPrefix=function(a){return this.each(function(b,c){var d=c.className.split(" ").filter(function(b){return 0!==b.lastIndexOf(a,0)});c.className=$.trim(d.join(" "))}),this},$.fn.requiredId=function(){if(this.length>1)return this.each(function(){$(this).requiredId()});var a=this[0].id;return a||(a=jstack.uniqid("uid-"),this[0].setAttribute("id",a)),a},$.fn.reverse=function(){return $(this.get().reverse())},$.fn.setVal=$.fn.val,$.fn.val=function(){var a=$.fn.setVal.apply(this,arguments);return arguments.length&&this.trigger("val"),a},function(){var a=function(a,b,c){var d=a.hasClass("select2-hidden-accessible");if(!a[0].hasAttribute("data-preselect")||d){if(d){var e;if(e=c.preventValEvent?function(a,b){a.setVal(b)}:function(a,b){a.val(b)},c.push){var f=a.val();null===f&&(f=[]),"object"!=typeof f&&(f=[f]),f.indexOf(b)===-1&&f.push(b),e(a,b)}else e(a,b);return void(c.preventValEvent||a.trigger("change"))}var g=!1,h="option";if(a.children().each(function(a){var d=$(this);"option"==this.tagName.toLowerCase()?d.val()==b?(d.prop("selected",!0),g=!0):c.push||d.prop("selected",!1):(0==a&&(h=d[0].tagName.toLowerCase()),d[0].getAttribute("value")==b?(d[0].setAttribute("selected","selected"),g=!0):c.push||d[0].removeAttribute("selected"))}),!g&&c.addMissing&&void 0!==b&&null!==b){var i,j;"object"==$.type(b)?(i=b.value,j=b.text):i=b,void 0===j&&(j=i),i||(i=j),a.append("<"+h+' value="'+i+'" selected="selected">'+j+"</"+h+">")}}else if(c.push){var f=a.data("preselect")||[];"object"!=typeof f&&(f=[f]),f.indexOf(b)===-1&&f.push(b),a.data("preselect",f)}else a.data("preselect",b)};$.fn.populateInput=function(b,c){void 0!==b&&null!==b||(b=""),c=$.extend({addMissing:this[0].hasAttribute("j-add-missing"),preventValEvent:!1,push:!1},c);var d;return d=c.preventValEvent?function(a,b){a.setVal(b)}:function(a,b){a.val(b)},this.each(function(){var e=$(this);if(!e.data("j:populate:prevent")){var f=this.tagName.toLowerCase();if("select"==f||"j-select"==f)if(b instanceof Array)if("[]"==this.getAttribute("name").substr(-2)||this.hasAttribute("multiple"))a(e,b,c);else for(var g=0,h=b.length;g<h;g++)a(e,b[g],c);else a(e,b,c);else if("textarea"==e[0].tagName.toLowerCase())d(e,b);else switch(e[0].getAttribute("type")){case"file":return;default:case"number":case"range":case"email":case"data":case"text":case"hidden":d(e,b);break;case"radio":e.length&&e.each(function(){$(this).prop("checked",this.value==b)});break;case"checkbox":e.length>1?$.each(e,function(a){for(var d,e=this.value,f=void 0,g=0;g<b.length;g++)(d=b[g])===e&&(f=d);f?$(this).prop("checked",!0):c.push||$(this).prop("checked",!1)}):1==e.length&&(b?e.prop("checked",!0):e.prop("checked",!1))}}})},$.fn.populateForm=function(a,b){b=$.extend({not:!1,notContainer:!1},b);var c=this,d=function(a,d){null===d&&(d="");var e=c.find(':input[name="'+a+'"]');b.addMissing&&!e.length&&c.append('<input type="hidden" name="'+a+'" value="'+d+'">'),e.each(function(){var a=$(this);b.not&&a.is(b.not)||b.notContainer&&a.closest(b.notContainer).length||a.populateInput(d,b)})},e=function(a,d){c.find(':input[name="'+a+'"],:input[name="'+a+'[]"]').each(function(){var a=$(this);b.not&&a.is(b.not)||b.notContainer&&a.closest(b.notContainer).length||a.populateInput(d,b)})},f=function(a,b){e(a,b),$.each(b,function(b,c){var e=a+"["+b+"]";"object"==typeof c&&null!=c?f(e,c):d(e,c)})};return $.each(a,function(a,b){"object"==typeof b&&null!=b?f(a,b):d(a,b)}),this},$.fn.populate=function(a,b){return this.each(function(){"form"==this.tagName.toLowerCase()?$(this).populateForm(a,b):$(this).populateInput(a,b)})},$.fn.populateReset=function(){return this.each(function(){if("form"==this.tagName.toLowerCase())$(this).find(":input[name]").populateReset();else{var a=$(this),b=a.prop("type");"checkbox"==b||"radio"==b?a.prop("checked",this.defaultChecked):a.populateInput(this.defaultValue,{preventValEvent:!0}),a.trigger("input")}})}}(),$.fn.outerHTML=function(){if(this.length){var a=$('<tmpl style="display:none;"></tmpl>'),b=($(this[0].cloneNode(!1)).html(this.html()).appendTo(a),a.html());return a.remove(),b}return null},$.fn.hasAttr=function(a){return this[0].hasAttribute(a)},$.fn.jComponentReady=function(a){var b=this,c=$.Deferred();a&&c.then(function(){b.each(function(){a.call(this)})});var d=function(){var a=!0;b.each(function(){if(!$(this).data("j.component.loaded"))return a=!1,!1}),a&&c.resolve()};return this.on("j:component:loaded",function(){d()}),d(),c.promise()};var rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i,rcheckableType=/^(?:checkbox|radio)$/i;jQuery.fn.serializeArrayWithEmpty=function(){return this.map(function(){var a=jQuery.prop(this,"elements");return a?jQuery.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(a)&&(this.checked||!rcheckableType.test(a))}).map(function(a,b){var c=jQuery(this).val();return null==c&&(c=""),jQuery.isArray(c)?jQuery.map(c,function(a){return{name:b.name,value:a.replace(rCRLF,"\r\n")}}):{name:b.name,value:c.replace(rCRLF,"\r\n")}}).get()},function(a,b){if("function"==typeof define&&define.amd)define(["exports","jquery"],function(a,c){return b(a,c)});else if("undefined"!=typeof exports){var c=require("jquery");b(exports,c)}else b(a,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b){function c(a,c){function e(a,b,c){return a[b]=c,a}function f(a,b){for(var c,f=a.match(d.key);void 0!==(c=f.pop());)if(d.push.test(c)){var h=g(a.replace(/\[\]$/,""));b=e([],h,b)}else 0==c?b=e([],c,b):d.named.test(c)&&(b=e({},c,b));return b}function g(a){return void 0===n[a]&&(n[a]=0),n[a]++}function h(a){switch(b('[name="'+a.name+'"]',c)[0].type){case"checkbox":return"on"===a.value||a.value;default:return a.value}}function i(b){if(!d.validate.test(b.name))return this;var c=f(b.name,h(b));return m=a.extend(!0,m,c),this}function j(b){if(!a.isArray(b))throw new Error("formSerializer.addPairs expects an Array");for(var c=0,d=b.length;c<d;c++)this.addPair(b[c]);return this}function k(){return m}function l(){return JSON.stringify(k())}var m={},n={};this.addPair=i,this.addPairs=j,this.serialize=k,this.serializeJSON=l}var d={validate:/^[a-z_][a-z0-9_]*(?:\[(?:\d*|[a-z0-9_]+)\])*$/i,key:/[a-z0-9_]+|(?=\[\])/gi,push:/^$/,named:/^[a-z0-9_]+$/i};return c.patterns=d,c.serializeObject=function(){return new c(b,this).addPairs(this.serializeArrayWithEmpty()).serialize()},c.serializeJSON=function(){return new c(b,this).addPairs(this.serializeArrayWithEmpty()).serializeJSON()},void 0!==b.fn&&(b.fn.serializeObject=c.serializeObject,b.fn.serializeJSON=c.serializeJSON),a.FormSerializer=c,c}),$.prettifyHTML=function(a){if(a=$(a),a.parent().length>0&&a.parent().data("assign")?a.data("assign",a.parent().data("assign")+1):a.data("assign",1),a.children().length>0)a.children().each(function(){for(tbc="",i=0;i<$(this).parent().data("assign");i++)tbc+="\t";$(this).before("\n"+tbc),$(this).prepend("\t"),$(this).append("\n"+tbc),$.prettifyHTML($(this))});else{for(tbc="",i=0;i<a.parent().data("assign");i++)tbc+="\t";a.prepend("\n"+tbc)}return a.outerHTML()},$.fn.replaceTagName=function(a){for(var b=[],c=this.length;c--;){for(var d=document.createElement(a),e=this[c],f=e.attributes,g=f.length-1;g>=0;g--){var h=f[g];d.setAttribute(h.name,h.value)}d.innerHTML=e.innerHTML,$(e).replaceWith(d),b[c]=d}return $(b)},$.fn.jModel=function(a,b){if(this.length<=1){var c=jstack.dataBinder.getControllerData(this[0]);return void 0!==a?void 0===c[a]?b:c[a]:c}var d=[];return this.each(function(){d.push($(this).jModel(a,b))}),d},$.fn.findComments=function(a){var b=[];return this.each(function(){for(var c=0;c<this.childNodes.length;c++){var d=this.childNodes[c];d.nodeType!==Node.COMMENT_NODE||a&&d.nodeValue.split(" ")[0]!=a?b.push.apply(b,$.fn.findComments.call($(d))):b.push(d)}}),$(b)},$.fn.findCommentsChildren=function(a){var b=[];return this.each(function(){for(var c=0;c<this.childNodes.length;c++){var d=this.childNodes[c];d.nodeType===Node.COMMENT_NODE&&d.nodeValue.split(" ")[0]==a?b.push.apply(b,$(d).commentChildren()):b.push.apply(b,$.fn.findCommentsChildren.call($(d),a))}}),$(b)},$.fn.commentChildren=function(){var a=[];return this.each(function(){for(var b="/"+this.nodeValue.split(" ")[0],c=this.nextSibling;c&&(c.nodeType!==Node.COMMENT_NODE||c.nodeValue!=b);)a.push(c),c=c.nextSibling}),$(a)},$.fn.parentComment=function(a){var b=[];for(n=this[0].previousSibling;n;){if(n.nodeType===Node.COMMENT_NODE&&n.nodeValue.split(" ")[0]===a){b.push(n);break}n=n.previousSibling}return $(b)},$.fn.parentsComment=function(a){var b=[];for(n=this[0].previousSibling;n;)n.nodeType===Node.COMMENT_NODE&&n.nodeValue.split(" ")[0]===a&&(b.push(n),n=n.parentNode),n&&(n=n.previousSibling);return $(b)},$.fn.dataComment=function(){if(arguments.length>1||"object"==$.type(arguments[0])){var a;return arguments.length>1?(a={},a[arguments[0]]=arguments[1]):a=arguments[0],this.each(function(){var b=$(this).dataComment();$.extend(b,a)})}var b=this[0];b.__jstackData||(b.__jstackData={});let c=b.__jstackData;return arguments.length&&(c=c[arguments[0]]),c},$.fn.jData=function(a){if(this.length>1){var b=[];return this.each(function(){b.push($.fn.jData.call($(this),a))}),b}{var b={},c=this[0];let e,f=$(jstack.dataBinder.getController(c)).data("jController");f&&(e=f.dataBinder),$.each(this.attrStartsWith("j-data-"),function(a,d){var f=jstack.dataBinder.textTokenizer(d),g=d;f!==!1&&e&&(g=e.compilerAttrRender(c,f)),b[a]=g});var d={};return $.each(b,function(a,b){$.attrsToObject(a.substr(7),b,d)}),a&&(d=jstack.dataBinder.dotGet(a,d)),d}},$.fn.onJstackReady=function(a,b,c){if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(var d in a)this.onJstackReady(d,b,c,a[d]);return this}var e,f=[a];return"string"==typeof b?(f.push(b),e=c):e=b,f.push(function(){var a=arguments,b=this;return jstack.ready(function(){e.apply(b,a)})}),this.on.apply(this,f)},$.onJstackReady=function(a,b,c){return $(document).onReady(a,b,c)},$.xhrPool=[],$.xhrPool.abortAll=function(a){$(this).each(function(b,c){a!==!0&&a!=c.jstackNS||(c.abort(),$.xhrPool.splice(b,1))})},$(document).ajaxSend(function(a,b){$.xhrPool.push(b)}),$(document).ajaxComplete(function(a,b){var c=$.xhrPool.indexOf(b);c>-1&&$.xhrPool.splice(c,1)}),$.ajaxPrefilter(function(a,b,c){c.jstackNS=a.namespace||jstack.ajaxNamespace}),$.fn.onFirst=function(a,b){var c=$(this);c.off(a,b),c.on(a,b);var d=$._data(c[0]).events,e=d[a];e.unshift(e.pop()),d[a]=e},$.fn.onLast=function(a,b){return this.each(function(){var c=1e6,d=a.split("."),e=d[0];$(this).on(a,b);var f=$._data(this,"events"),g=!1,h={};if($.each(f[e],function(a,c){c===b&&(g=a),h[a]=1}),g!==!1){for(;1==h[c];)c++;f[e][c]=f[e][g],delete f[e][g]}})},function(){var a={},b={};jstack.getTemplate=function(c,d){if(d||(c=jstack.config.templatesPath+c),!b[c]){var e=c;if(jstack.config.debug){var f=(new Date).getTime().toString();e.indexOf("_t=")===-1&&(e+=(e.indexOf("?")<0?"?":"&")+"_t="+f)}b[c]=$.Deferred(),$.ajax({url:e,cache:!0}).then(function(d){a[c]=d,b[c].resolve(d,c)})}return b[c].promise()}}(),jstack.route=function(a,b){var c=[],d={},e=function(a,b){this.name=b,this.path=a,this.keys=[],this.fns=[],this.params={},this.regex=f(this.path,this.keys,!1,!1)};e.prototype.addHandler=function(a){this.fns.push(a)},e.prototype.removeHandler=function(a){for(var b=0,c=this.fns.length;b<c;b++){if(a==this.fns[b])return void this.fns.splice(b,1)}},e.prototype.run=function(a,b){$(document).trigger("j:route:unload");for(var c=a.shift(),d=0,e=this.fns.length;d<e;d++){var f=this.fns[d].call(this,c,a,b);"object"==$.type(f)&&"then"in f?f.then(function(){$(document).trigger("j:route:loaded",[c,a,b])}):$(document).trigger("j:route:loaded",[c,a,b])}},e.prototype.match=function(a,b){var c=this.regex.exec(a);if(!c)return!1;b.push(a);for(var d=1,e=c.length;d<e;++d){var f=this.keys[d-1],g="string"==typeof c[d]?decodeURIComponent(c[d]):c[d];f&&(this.params[f.name]=g),b.push(g)}return!0},e.prototype.toURL=function(a){var b=this.path;for(var c in a)b=b.replace("/:"+c,"/"+a[c]);if(b=b.replace(/\/:.*\?/g,"/").replace(/\?/g,""),b.indexOf(":")!=-1)throw new Error("missing parameters for url: "+b);return b};var f=function(a,b,c,d){return a instanceof RegExp?a:(a instanceof Array&&(a="("+a.join("|")+")"),a=a.concat(d?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+a+"$",c?"":"i"))},g=function(a,b){var f=a.split(" "),g=2==f.length?f[0]:null;a=2==f.length?f[1]:f[0],d[a]||(d[a]=new e(a,g),c.push(d[a])),c=c.sort(function(a,b){return"*"==a.path||c.indexOf(a)>c.indexOf(b)}),h.singleHandler&&(d[a].fns=[]),d[a].addHandler(b)},h=function(a,c,d){if("function"==typeof c)g(a,c);else if("object"==typeof a)for(var e in a)g(e,a[e]);else if(void 0===c)h.navigate(a);else if("object"==typeof c){var f={};d&&$.extend(f,w()),$.extend(f,b.getParams(a),c);var i=b.buildQuery(f);i&&(i="?"+i),a=b.getPath(a),h.navigate(a+i)}};h.lookup=function(a,b){for(var d=0,e=c.length;d<e;d++){var f=c[d];if(f.name==a)return f.toURL(b)}},h.remove=function(a,b){var c=d[a];c&&c.removeHandler(b)},h.removeAll=function(){d={},c=[]},h.navigate=function(b,c){c=c||{};var d=c.silent||!1;d&&t(),setTimeout(function(){a.location.hash=b,d&&setTimeout(function(){s()},1)},1)};var i=function(){var a="",b=n.substring(1),c=b.indexOf("#");return c!==-1&&(a=b.substr(c+1)),a},j=function(){var a=n.substring(1),b=a.indexOf("#");return b!==-1&&(a=a.substr(0,b)),a},k=function(a,b,c){var d=[];return!!b.match(a,d)&&(b.run(d,c),!0)},l=function(a){for(var b=h.getPath(a),d=0,e=c.length;d<e;d++){if(k(b,c[d],a))return}};h.load=l;var m,n=a.location.hash,o=function(b){n=b?b.newURL.substr(b.newURL.indexOf("#")):a.location.hash;var c=j();c!=m?(m=c,$(document).trigger("j:route:load"),l(m)):$(document).trigger("j:subroute:change")};h.reload=o;var p=function(b){var c=this.getAttribute("href");if(c)return"/"+c==a.location.pathname?(b.preventDefault(),jstack.route(""),!1):void("##"==c.substr(0,2)&&(b.preventDefault(),r(c.substr(2))))},q=function(b){var c=b+"#"+i();a.location.hash=c},r=function(b){var c=m+"#"+b;a.location.hash=c},s=function(){a.addEventListener?a.addEventListener("hashchange",o,!1):a.attachEvent("onhashchange",o),$(document).on("click","a",p),h.reload()},t=function(){a.removeEventListener?a.removeEventListener("hashchange",o):a.detachEvent("onhashchange",o),$(document).off("click","a",p)};h.start=s,h.stop=t;var u=function(){return b.getQuery(j())},v=function(){return b.getPath(j())},w=function(){return b.getParams(j())},x=function(a){return w()[a]},y=function(){return b.getParams("?"+i())},z=function(a){return y()[a]};h.getHash=j,h.getHash2=i,h.getParams=w,h.getParam=x,h.getSubParams=y,h.getSubParam=z,h.getQuery=u,h.getPath=v,h.setMainHash=q,h.setSubHash=r,h.singleHandler=!0;var A=document.getElementsByTagName("base")[0];if(A)h.baseHref=A.href;else{var B=window.location,C=B.pathname;C=C.split("/"),C.pop(),C=C.join("/")||"/";var D,E=B.username?B.username+(B.password?":"+B.password:"")+"@":"";D=B.port&&("https"==B.protocol&&"443"!=B.port||"80"!=B.port)?":"+B.port:"",h.baseHref=B.protocol+"//"+E+B.host+D+C}var F=a.location.href;F=F.split("/"),F=F[0]+"//"+F[2],F=h.baseHref.substr(F.length),h.basePath=F;var G=a.location.href.substr(h.baseHref.length),H=G.indexOf("#");return H>-1&&(G=G.substr(0,H)),h.baseLocation=G,h}(window,jstack.url),jstack.routeMVC=function(a,b){return jstack.route(a,function(a,c,d){let e=$("[j-app]");return"string"==typeof b&&(b={view:b}),e.empty(),jstack.mvc({view:b.view,controller:b.controller||b.view,hash:d,target:$("<div/>").appendTo(e)})})},jstack.dataBindingCompilers={},
$(document.body).on("reset","form",function(){$(this).populateReset()}),function(){const a=new RegExp("(\\()(.*)(,)(.*)(,)(.*)(\\))(\\s+)(in)(\\s+)(.*)",["i"]),b=new RegExp("(\\()(.*)(,)(.*)(\\))(\\s+)(in)(\\s+)(.*)",["i"]),c=new RegExp("(.*)(\\s+)(in)(\\s+)(.*)",["i"]);jstack.dataBindingCompilers.for={match(){return this.nodeType===Node.ELEMENT_NODE&&this.hasAttribute("j-for")},callback(d){let e=this,f=$(this),g=$("<!--j:for-->"),h=$("<!--/j:for-->");f.replaceWith(g),h.insertAfter(g);let i=e.getAttribute("j-for");e.removeAttribute("j-for"),i=i.trim();let j,k,l,m,n=a.exec(i);if(null!=n)j=n[2].trim(),k=n[4].trim(),l=n[6],m=n[11].trim();else{let a=b.exec(i);if(null!=a)k=a[2].trim(),l=a[4],m=a[9].trim();else{let a=c.exec(i);if(null==a)throw new Error("Malformed for clause: "+i);l=a[1],m=a[5].trim()}}let o,p=function(){return d.getValueEval(g[0],m)};g.dataComment({value:l,key:k,index:j});let q="template"==e.tagName.toLowerCase(),r=this.content,s=function(){let a=p();if(o!==a){o=a,a||(a=[]);let b={};$.each(g.commentChildren(),function(a,c){if(c.nodeType===Node.COMMENT_NODE&&"j:for:id"==this.nodeValue.split(" ")[0]){let a=$(c),d=a.dataComment("j:for:row");if(d&&void 0!==d.key){let c=d.key;b[c]=a}}});let c=1;$.each(a,function(a,d){let e=b[a];delete b[a];let g;if(e||(e=$("<!--j:for:id-->"),g=!0),e.dataComment("j:for:row",{value:d,index:c,key:a}),g){e.insertBefore(h);let b;q?b=$(document.importNode(r,!0)):(b=f.clone(),b.attr("j-for-id",a)),b.insertBefore(h),$("<!--/j:for:id-->").insertBefore(h)}c++}),$.each(b,function(a,b){b.commentChildren().remove(),b.remove()})}};d.addWatcher(g[0],s),s()}}}(),jstack.dataBindingCompilers.switch={match(){return this.nodeType===Node.ELEMENT_NODE&&this.hasAttribute("j-switch")},callback(a){var b=this,c=$(this),d=this.getAttribute("j-switch");this.removeAttribute("j-switch");var e,f=c.find("[j-case],[j-case-default]"),g=function(){return Boolean(a.getValueEval(b,d))},h=function(){var a=g();if(e!==a){e=a;var b=!1;f.filter("[j-case]").each(function(){var d=$(this);this.getAttribute("j-case")==a?(d.appendTo(c),b=!0):d.detach()}),f.filter("[j-case-default]").each(function(){var a=$(this);b?a.detach():a.appendTo(c)})}};a.addWatcher(b,h),h()}},jstack.dataBindingCompilers.show={match(){return this.nodeType===Node.ELEMENT_NODE&&this.hasAttribute("j-show")},callback(a){var b=this,c=$(this),d=this.getAttribute("j-show");this.removeAttribute("j-show");var e,f=function(){return Boolean(a.getValueEval(b,d))},g=function(){var a=f();e!==a&&(e=a,a?c.show():c.hide())};a.addWatcher(b,g),g()}},jstack.dataBindingCompilers.href={match(){return this.nodeType===Node.ELEMENT_NODE&&this.hasAttribute("j-href")},callback(a){var b=this,c=($(this),this.getAttribute("j-href"));this.removeAttribute("j-href");var d=jstack.dataBinder.textTokenizer(c);if(d===!1)return void b.setAttribute("href",jstack.route.baseLocation+"#"+c);var e,f=a.createCompilerAttrRender(b,d),g=function(){var a=f();e!==a&&(e=a,b.setAttribute("href",jstack.route.baseLocation+"#"+a))};a.addWatcher(b,g),g()}},jstack.dataBindingCompilers.twoPoints={match(){if(this.nodeType===Node.ELEMENT_NODE){for(var a,b=0,c=this.attributes,d=c.length;b<d;b++){var e=c[b];":"===e.name.substr(0,1)&&(a||(a={}),a[e.name]=e.value)}return a}},callback(a,b){var c=this,d=$(this),e={},f={},g=["selected","checked"];this.nodeName.toLowerCase();$.each(b,function(a,b){var d=jstack.dataBinder.textTokenizer(b),f=a.substr(1);d===!1?c.setAttribute(f,b):e[f]=d,c.removeAttribute(a)});var h=function(){$.each(e,function(b,e){var h=a.compilerAttrRender(c,e);f[b]!==h&&(f[b]=h,g.indexOf(b)!==-1?d.prop(b,h):"boolean"==typeof h?h?c.setAttribute(b,b):c.removeAttribute(b):c.setAttribute(b,h))})};a.addWatcher(c,h),h()}},jstack.dataBindingCompilers.inputFile={match(){return this.nodeType===Node.ELEMENT_NODE&&this.hasAttribute("name")&&"input"==this.tagName.toLowerCase()&&"file"==this.type},callback(a){$(this).on("input change",function(b){a.inputToModel(this,b.type)})}},function(){const a={input:1,select:1,textarea:1,button:1,"j-input":1,"j-select":1};jstack.dataBindingCompilers.input={match(){return this.nodeType===Node.ELEMENT_NODE&&this.hasAttribute("name")&&a[this.tagName.toLowerCase()]&&"file"!=this.type},callback(a,b){var c,d=this,e=$(this),f=jstack.dataBinder.getScopedInput(d),g=jstack.dataBinder.getInputVal(d);let h=jstack.dataBinder.getControllerData(d);jstack.dataBinder.dotSet(f,h,g,!0);var i=function(){var b=jstack.dataBinder.getInputVal(d),c=jstack.dataBinder.getKey(d.getAttribute("name"));return a.getValue(d,c,b)},j=function(){var a=i();c!==a&&(c=a,e.data("j:populate:prevent")||setTimeout(function(){e.populateInput(a,{preventValEvent:!0}),e.trigger("j:val",[a])}))};a.addWatcher(d,j),j()}}}();class dataBinder{constructor(a,b,c){this.model=a,this.view=b,this.controller=c,this.updateDeferQueued=!1,this.updateDeferInProgress=!1,this.updateDeferStateObserver=null,this.loadingMutation=0,this.deferMutation=[],this.noChildListNodeNames={area:1,base:1,br:1,col:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,menuitem:1,meta:1,param:1,source:1,track:1,wbr:1,script:1,style:1,textarea:1,title:1,math:1,svg:1,canvas:1},this.watchers=new WeakMap}ready(a){let b=this,c=$.Deferred(),d=[];return setTimeout(function(){if(b.updateDeferStateObserver&&d.push(b.updateDeferStateObserver),b.loadingMutation>0){var e=$.Deferred();b.deferMutation.push(function(){e.resolve()}),d.push(e)}$.when.apply($,d).then(function(){c.resolve()}),a&&c.then(function(){a()})}),c.promise()}getValue(a,b,c){var d="",e=dataBinder.getClosestFormNamespace(a.parentNode);return e&&(d+=e+"."),d+=b,dataBinder.dotGet(d,this.model,c)}getParentsForId(a){for(var b=[],c=a;c&&(c.nodeType===Node.COMMENT_NODE&&"j:for:id"===c.nodeValue.split(" ")[0]&&(b.push(c),c=c.parentNode),c&&(c=c.previousSibling?c.previousSibling:c.parentNode),c!==document.body););return b}getValueEval(a,b){let c=this.controller,d=this.model;d=d?JSON.parse(JSON.stringify(d)):{},void 0===b?b="undefined":null===b?b="null":""==b.trim()?b="undefined":(b=b.replace(/[\r\t\n]/g,""),b=b.replace(/(?:^|\b)(this)(?=\b|$)/g,"$this"));var e=this.getParentsForId(a).reverse();for(let f=0,g=e.length;f<g;f++){let c=e[f],g=$(c),h=g.parentComment("j:for");if(h.length){let c=h.dataComment(),e=c.value,f=g.dataComment("j:for:row");f||console.log(b,a,g,g.dataComment());let i=c.index,j=c.key;i&&(d[i]=f.index),j&&(d[j]=f.key),d[e]=f.value}}var h=["$controller","$this","$scope"],i=[c,a,d];$.each(d,function(a,b){h.push(a),i.push(b)}),h.push("return "+b+";");var j;try{j=Function.apply(null,h).apply(null,i)}catch(c){if(jstack.config.debug){var k=[c.message,", expression: "+b,"element",a];a.nodeType==Node.COMMENT_NODE&&k.push($(a).parent().get()),console.warn.apply(console,k)}}return void 0===j?"":j}inputToModel(a,b,c){var d,e=$(a),f=this.model,g=(a.getAttribute("name"),function(){var c=dataBinder.getScopedInput(a);h!=d&&(d=h,e.populateInput(d,{preventValEvent:!0}));var g=dataBinder.dotGet(c,f);d=dataBinder.dotSet(c,f,d),e.trigger("j:input",[d]),"j:update"==b?e.trigger("j:input:update",[d]):e.trigger("j:input:user",[d]),g!==d&&e.trigger("j:change",[d,g])});d=void 0!==c?c:dataBinder.getInputVal(a);var h=this.filter(a,d);"object"==typeof h&&null!==h&&"function"==typeof h.promise?h.then(function(a){h=a,g()}):g()}addWatcher(a,b){let c=this.watchers,d=c.get(a);d||(d=[],c.set(a,d)),d.push(b)}runWatchers(){let a=this.watchers,b=(new Date).getTime();console.log("runWatchers START");let c=0;jstack.walkTheDOM(this.view,function(b){let d=a.get(b);if(d)for(let e=0,f=d.length;e<f;e++)d[e](),c++}),console.log("runWatchers END",c,((new Date).getTime()-b)/1e3+"s")}update(){var a=this;this.updateDeferQueued||(this.updateDeferInProgress?this.updateDeferQueued=!0:(this.updateDeferInProgress=!0,this.updateDeferStateObserver||(this.updateDeferStateObserver=$.Deferred()),setTimeout(function(){a.runWatchers(),a.updateDeferQueued?(a.updateDeferInProgress=!1,a.updateDeferQueued=!1,a.update()):(a.updateDeferStateObserver.resolve(),a.updateDeferStateObserver=null,a.updateDeferInProgress=!1)},10)))}eventListener(){let a=this;a.observe(this.view,!0),$(this.view).on("input change j:update",":input[name]",function(b,c){if("file"!=this.type&&("input"!=b.type||"select"!=this.nodeName.toLowerCase()&&"checkbox"!=this.type&&"radio"!=this.type)){let d=this;setTimeout(function(){a.inputToModel(d,b.type,c)})}})}observe(a,b){if(a.nodeType==Node.ELEMENT_NODE&&!this.noChildListNodeNames[a.tagName.toLowerCase()]&&(b||!a.hasAttribute("j-view"))){if(a.hasAttribute("j-escape"))return!1;let b=this;new MutationObserver(function(a){b.loadingMutation++,setTimeout(function(){b.loadMutations(a)})}).observe(a,{subtree:!1,childList:!0,characterData:!0,attributes:!1,attributeOldValue:!1,characterDataOldValue:!1})}}loadMutations(a){let b=this,c=[];$.each(a,function(a,d){$.each(d.addedNodes,function(a,d){b.compileNode(d,c)}),$.each(d.removedNodes,function(a,b){jstack.walkTheDOM(b,function(a){if(a.nodeType!==Node.ELEMENT_NODE||!$(a).data("j:load:state"))return!1;jstack.trigger(a,"unload")})})}),setTimeout(function(){if(0==--b.loadingMutation)for(;b.deferMutation.length;)b.deferMutation.pop()();for(let a=0,d=c.length;a<d;a++)c[a]()})}compileNode(a,b){var c=this;jstack.walkTheDOM(a,function(a){if(!document.body.contains(a))return!1;if(c.observe(a)===!1)return!1;var d=$(a);if(a.nodeType==Node.ELEMENT_NODE)return!!document.body.contains(a)&&void b.push(function(){document.body.contains(a)&&(a.hasAttribute("j-cloak")&&a.removeAttribute("j-cloak"),d.data("j:load:state")||(d.data("j:load:state",!0),jstack.trigger(a,"load")))})})}compileHTML(a){let b=this,c=$($("<html>"+a+"</html>").get());return $.each(jstack.dataBindingCompilers,function(a,d){c.each(function(){jstack.walkTheDOM(this,function(a){var c=d.match.call(a);c&&d.callback.call(a,b,c)})})}),c}filter(a,b){var c=this.getFilter(a);return"function"==typeof c&&(b=c(b)),b}getFilter(a){let b=$(a);var c=b.data("j-filter");if(!c){var d=a.getAttribute("j-filter");if(d){var e=this.getValue(a,d);b.data("j-filter",e)}}return c}compilerAttrRender(a,b){for(var c="",d=0,e=b.length;d<e;d++){var f=b[d];if("{{"==f.substr(0,2)){f=f.substr(2,f.length-4);"::"==f.substr(0,2)&&(f=f.substr(2),freeze=!0),f=this.getValueEval(a,f)}c+=void 0!==f&&null!==f?f:""}return c}createCompilerAttrRender(a,b){let c=this;return function(){return c.compilerAttrRender(a,b)}}static textTokenizer(a){var b=/\{\{((?:.|\n)+?)\}\}/g;if(!b.test(a))return!1;for(var c,d,e=[],f=b.lastIndex=0;c=b.exec(a);){d=c.index,d>f&&e.push(a.slice(f,d));var g=c[1].trim();e.push("{{"+g+"}}"),f=d+c[0].length}return f<a.length&&e.push(a.slice(f)),e}static dotGet(a,b,c){if("object"==typeof b&&null!==b)return a.split(".").reduce(function(a,b){return"object"==typeof a&&null!==a&&void 0!==a[b]?a[b]:c},b)}static dotSet(a,b,c,d){if("object"==typeof b&&null!==b)return a.split(".").reduce(function(a,b,e,f){if(f.length!=e+1)return"object"==typeof a[b]&&null!==a[b]||(a[b]={}),a[b];d?void 0===a[b]?(a=jstack.getObserverTarget(a),a[b]=c):c=a[b]:a[b]=c},b),c}static dotDel(a,b,c){"object"==typeof b&&null!==b&&a.split(".").reduce(function(a,b,c,d){if("object"==typeof a)return d.length!=c+1?a[b]:void(void 0!==a[b]&&delete a[b])},b)}static getKey(a){return a.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").replace(/\[\]/g,".")}static getClosestFormNamespace(a){for(;a;){if(a.tagName&&"form"==a.tagName.toLowerCase()){if(a.hasAttribute("j-name"))return a.getAttribute("j-name");break}a=a.parentNode}}static getScopedInput(a){var b=a.getAttribute("name"),c=dataBinder.getKey(b);if("."==c.substr(-1)&&"checkbox"==a.type){var d;$(dataBinder.getController(a.parentNode)).find(':checkbox[name="'+b+'"]').each(function(b){if(this===a)return d=b,!1}),c+=d}var e="",f=dataBinder.getClosestFormNamespace(a.parentNode);return f&&(e+=f+"."),e+=c}static getInputVal(a){switch(a.tagName.toLowerCase()){case"input":switch(a.type){case"checkbox":var b=$(a);return b.prop("checked")?b.val():"";case"radio":for(var c,d=a.parentNode;d;){if(d.tagName&&"form"==d.tagName.toLowerCase()){c=d;break}d=d.parentNode}if(c){var e=$(c).find('[name="'+a.getAttribute("name")+'"]:checked');return e.length?e.val():""}return"";case"file":return a.files;case"submit":break;default:return $(a).val()}break;case"textarea":case"select":return $(a).val();case"j-select":a=$(a);var f=a[0].hasAttribute("multiple"),g=a.data("preselect");return g||(f&&(g=[]),a.children().each(function(){if(this.hasAttribute("selected")){var a=this.value;if(!f)return g=a,!1;g.push(a)}})),g;default:return $(a).html()}}static getControllerData(a){return $(dataBinder.getController(a)).data("jModel")}static getController(a){let b;for(;a;){if(a.hasAttribute&&a.hasAttribute("j-controller")){b=a;break}a=a.parentNode}return b||(b=document.body,b.setAttribute("j-controller",""),$(b).data("jModel",{})),b}static getControllerObject(a){return $(dataBinder.getController(a)).data("jController")}}jstack.dataBinder=dataBinder,jstack.dataBindingCompilers.text={match(){return this.nodeType==Node.TEXT_NODE&&this instanceof Text&&this.textContent},callback(a){let b=this.textContent.toString(),c=jstack.dataBinder.textTokenizer(b);if(c!==!1){let b=$(this),d=b;for(let e=0,f=c.length;e<f;e++){let b=c[e];if("{{"==b.substr(0,2)){let c=$("<!--j:text-->"),e=$("<!--/j:text-->");c.insertAfter(d),e.insertAfter(c),d=e,b=b.substr(2,b.length-4);let f=!1;"::"===b.substr(0,2)&&(b=b.substr(2),f=!0);let g,h=function(){let d=a.getValueEval(c[0],b);g!==d&&(g=d,c.commentChildren().remove(),c.after(d))};h(),f||a.addWatcher(c[0],h)}else b=document.createTextNode(b),d.after(b),d=b}b.remove()}}},jstack._eventStack={},jstack.trigger=function(a,b){let c=$(a),d=c.data("j:event:"+b);d&&d.forEach(function(b){b.call(a)}),jstack._eventStack[b]&&$.each(jstack._eventStack,function(b,d){c.is(b)&&d.forEach(function(b){b.call(a)})})},jstack.on=function(a,b,c){if(jstack._eventStack[a]||(jstack._eventStack[a]={}),"string"==typeof b)void 0===jstack._eventStack[b]&&(jstack._eventStack[b]=[]),jstack._eventStack[b].push(c);else{let d=$(b),e=d.data("j:event:"+a);e||(e=[],d.data("j:event:"+a,e)),e.push(c)}},jstack.loader=function(a,b,c){jstack.on("load",a,function(){b.call(this)}),"function"==typeof c&&jstack.on("unload",a,function(){c.call(this)}),$(a).each(function(){b.call(this)})},$.fn.onLoad=function(a){return this.each(function(){jstack.on("load",this,a)})},$.fn.onUnload=function(a){return this.each(function(){jstack.on("unload",this,a)})},jstack.component={},jstack.loader(':attrStartsWith("j-on-")',function(){var a=$(this),b=a.attrStartsWith("j-on-"),c=jstack.dataBinder.getControllerObject(this);$.each(b,function(b,d){var e=b.substr(5);a[0].removeAttribute(b),a.on(e,function(a){if("object"!=typeof c.methods||"function"!=typeof c.methods[d])throw new Error('Call to undefined method "'+d+'" by '+b+" and expected in controller "+c.name);var e=c.methods[d];if("function"==typeof e){return e.call(c,a,this)!==!1&&void 0}})})}),jstack.loader("[j-component]",function(){var a=this,b=$(a),c=a.getAttribute("j-component");if(c&&!a.getAttribute("j-component-handled")){a.setAttribute("j-component-handled","true");var d=b.jData(),e=a.getAttribute("j-params-data"),f=function(){var f,g=jstack.component[c];if(e){var h=[];h.push(a),f=new(Function.prototype.bind.apply(g,h))}else f=new g(a,d);b.data("j:component",f),f.deferred?f.deferred.then(function(){b.data("j.component.loaded",!0),b.trigger("j:component:loaded"),"function"==typeof f.unload&&jstack.on("unload",a,f.unload)}):(b.data("j.component.loaded",!0),b.trigger("j:component:loaded"),"function"==typeof f.unload&&jstack.on("unload",a,f.unload))};jstack.component[c]?f():$js("jstack."+c,f)}}),function(){var a=function(a){for(var b=[],c=$.param(a).split("&"),d=0;d<c.length;d++){var e=c[d].split("="),f=null!==e[1]?decodeURIComponent(e[1]):"";b.push([decodeURIComponent(e[0]),f])}return b},b=function(a,c,d,e){if(d||(d=""),a instanceof Array){for(var f={},g=0;g<a.length;g++)f[g]=a[g];return b(f,c,d,e)}if(void 0===a||null===a)a="";else if("object"==typeof a){var f={};Object.keys(a).forEach(function(g){var h=d+g,i=a[g];if(i instanceof FileList)if(1==i.length)c[h]=i[0];else{c[h]=[];for(var j=0;j<i.length;j++)c[h].push(i[j])}else f[g]=b(i,c,h+"_",e+1)}),a=f}return a};jstack.ajaxNamespace=void 0,jstack.ajax=function(){var c,d={};if(2==arguments.length?(c=arguments[1]||{},c.url=arguments[0]):c=arguments[0],c.data&&(c.data=b(c.data,d)),!$.isEmptyObject(d)){for(var e,f=new FormData,g=a(c.data),h=0;h<g.length;h++)f.append(g[h][0],g[h][1]);for(var i in d)if(d.hasOwnProperty(i)){var j=d[i];if(j instanceof Array)for(var h=0;h<j.length;h++)void 0!==j[h]&&(f.append(i+"[]",j[h]),e=!0);else void 0!==j&&(f.append(i,j),e=!0)}e&&(c.type="POST",c.processData=!1,c.contentType=!1,c.data=f)}return $.ajax(c)},jstack.post=function(a,b,c,d){let e=jstack.ajax({type:"POST",url:a,data:b,dataType:d});return"function"==typeof c&&e.then(c),e}}(),function(){jstack.mvc=function(a){var b=$(a.target),c=(a.controller,jstack.config.controllersPath+a.controller),d=$.Deferred(),d=$.Deferred();jstack.controllers[a.controller]?d.resolve():$js(c,d.resolve);var e=jstack.getTemplate(a.view+".jml"),f=$.Deferred();return d.then(function(){var c=jstack.controller(a.controller,b,a.hash);$.when(e,c).then(function(c,d){a.clear&&$(a.clear).contents().not(b).remove();var e=c[0],g=d.render(e);g?g.then(function(){f.resolve(b,d)}):f.resolve(b,d)})}),f.promise()};var a=function(a){if("string"==typeof arguments[0]){var b='[j-view="'+arguments[0]+'"]';a="object"==typeof arguments[1]?$(arguments[1]).find(b):$(b)}a=$(a);var c=a.data("jViewReady");return c||(c=$.Deferred(),a.data("jViewReady",c)),c};jstack.viewReady=function(b){return a(b).promise()},jstack.loader("[j-view]:not([j-view-loaded])",function(){this.setAttribute("j-view-loaded","true");var b,c=this.getAttribute("j-view");b=this.hasAttribute("j-controller")?this.getAttribute("j-controller"):c;var d=a(this);jstack.mvc({view:c,controller:b,target:this}).then(function(){d.resolve()})})}(),function(){jstack.app=function(a,b){b||(b=a[0].getAttribute("j-app")),jstack.config.templatesPath+=b+"/",jstack.config.controllersPath+=b+"/",$(document).on("j:route:unload",function(){$.xhrPool.abortAll()}),jstack.route("*",function(b,c,d){return b=jstack.url.getPath(b),jstack.mvc({view:b,controller:b,hash:d,target:$("<div/>").appendTo(a),clear:a[0]})})};var a=$("[j-app]");a.length&&jstack.app(a)}();