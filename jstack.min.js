jstackClass=function(){this.config={templatesPath:"view-js/",controllersPath:"controller-js/",defaultController:function(a){jstack.controller(a,function(){this.jstack.render()})},defaultTarget:"[j-app]",debug:$js.dev},this.controllers={}},jstackClass.prototype.extend=function(a,b){a.prototype=Object.create(b.prototype)},jstack=new jstackClass,jstack.controller=function(a){for(var b,c,d=!0,e=0;e<arguments.length;e++)switch(typeof arguments[e]){case"boolean":c=arguments[e];break;case"function":b=arguments[e];break;case"object":d=arguments[e]}if(d instanceof Array&&$js.require(d,c),b){var f=function(){return b.apply(f,arguments)};f.jstack={},jstack.controllers[a]=f}return jstack.controllers[a]},jstack.url=function(){var Url=function(){},recursiveArrayToObject=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(a[c]instanceof Array?b[c]=recursiveArrayToObject(a[c]):b[c]=a[c]);return b};return Url.prototype.params=new Array,Url.prototype.getQuery=function(a){var b=a,c=b.indexOf("?");return c==-1?"":(b=b.substr(c+1,b.length),c=b.indexOf("#"),c==-1?b:b.substr(0,c))},Url.prototype.getPath=function(a){var b=a.indexOf("?");return b==-1?a:a.substr(0,b)},Url.prototype.buildParamFromString=function(param){var p=decodeURIComponent(param),strpos=p.indexOf("=");if(strpos==-1)return""!==p&&(this.params[p]="",this.params.length++),!0;var name=p.substr(0,strpos),value=p.substr(strpos+1,p.length),openBracket=name.indexOf("["),closeBracket=name.indexOf("]");if(openBracket==-1||closeBracket==-1)return openBracket==-1&&closeBracket==-1||(name=name.replace(new RegExp("[\\[\\]]"),"_")),this.params[name]=value,!0;var matches=name.match(new RegExp("\\[.*?\\]","g"));name=name.substr(0,openBracket),p="this.params";var key=name;for(var i in matches)matches.hasOwnProperty(i)&&(p+="['"+key+"']",void 0!=eval(p)&&"object"==typeof eval(p)||eval(p+"= new Array();"),key=matches[i].substr(1,matches[i].length-2),""==key&&(key=eval(p).length));p+="['"+key+"']",eval(p+"= '"+value+"';")},Url.prototype.parseQuery=function(a){var b=a;b=b.replace(new RegExp("&"),"&"),this.params=new Array,this.params.length=0,b=b.split("&");for(var c=0;c<b.length;c++)this.buildParamFromString(b[c]);return recursiveArrayToObject(this.params)},Url.prototype.buildStringFromParam=function(a,b){var c="",d="";if(void 0!=b&&(c=b),"object"==typeof a)for(var e in a)d=a[e],e=""==c?e:"["+e+"]","object"==typeof d?this.buildStringFromParam(d,c+e):this.params[this.params.length]=c+e+"="+d},Url.prototype.buildQuery=function(a){return this.params=new Array,this.buildStringFromParam(a),this.params.join("&")},Url.prototype.getParams=function(a){return this.parseQuery(this.getQuery(a))},Url.prototype.getParamsFromHash=function(){return this.getParams(document.location.hash)},new Url}(),jstack.uniqid=function(a,b){"undefined"==typeof a&&(a="");var c,d=function(a,b){return a=parseInt(a,10).toString(16),b<a.length?a.slice(a.length-b):b>a.length?Array(1+(b-a.length)).join("0")+a:a};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed++,c=a,c+=d(parseInt((new Date).getTime()/1e3,10),8),c+=d(this.php_js.uniqidSeed,5),b&&(c+=(10*Math.random()).toFixed(8).toString()),c},String.prototype.camelCase=function(){return this.replace(/(\_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})},String.prototype.camelCaseDash=function(){return this.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})},String.prototype.lcfirst=function(){return this.charAt(0).toLowerCase()+this.substr(1)},String.prototype.escapeRegExp=function(){return this.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},String.prototype.replaceAllRegExp=function(a,b){return this.replace(new RegExp(a,"g"),b)},String.prototype.replaceAll=function(a,b){return a=a.escapeRegExp(),this.replaceAllRegExp(a,b)},String.prototype.snakeCase=function(){return this.replace(/([A-Z])/g,function(a){return"_"+a.toLowerCase()})},String.prototype.snakeCaseDash=function(){return this.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},function(){function a(a,b){var c=[" ","\n","\r","\t","\f","\x0B"," "," "," "," "," "," "," "," "," "," "," "," ","​","\u2028","\u2029","　"].join(""),d=0,e=0;for(a+="",b&&(c=(b+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^:])/g,"$1")),d=a.length,e=0;e<d;e++)if(c.indexOf(a.charAt(e))===-1){a=a.substring(e);break}for(d=a.length,e=d-1;e>=0;e--)if(c.indexOf(a.charAt(e))===-1){a=a.substring(0,e+1);break}return c.indexOf(a.charAt(0))===-1?a:""}function b(a,b){b=b?(b+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^:])/g,"$1"):" \\s ";var c=new RegExp("^["+b+"]+","g");return(a+"").replace(c,"")}function c(a,b){b=b?(b+"").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^:])/g,"\\$1"):" \\s ";var c=new RegExp("["+b+"]+$","g");return(a+"").replace(c,"")}String.prototype.trim=function(b){return a(this,b)},String.prototype.ltrim=function(a){return b(this,a)},String.prototype.rtrim=function(a){return c(this,a)}}(),String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.substr(1)},jstack.reflection={},jstack.reflection.arguments=function(f){var args=f.toString().match(/^\s*function\s+(?:\w*\s*)?\((.*?)\)\s*{/),r={};if(args&&args[1]){args=args[1],args=args.replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,""),args=args.trim().split(/\s*,\s*/);for(var i=0;i<args.length;i++){var arg=args[i],idf=arg.indexOf("=");idf===-1?r[arg]=void 0:r[arg.substr(0,idf)]=eval(arg.substr(idf+1).trim())}}return r},$.arrayCompare=function(a,b){return 0===$(a).not(b).get().length&&0===$(b).not(a).get().length},$.fn.attrStartsWith=function(a){var b={};return this.each(function(c){$.each(this.attributes,function(c,d){0===d.name.indexOf(a)&&(b[d.name]=d.value)})}),b},$.attrsToObject=function(a,b,c){c||(c={});var d=a.split("--");"undefined"==typeof c&&(c={});var e=c,f=d.length-1;return $.each(d,function(a,c){c=$.camelCase(c),a==f?e[c]=b:(e[c]||(e[c]={}),e=e[c])}),c},$.fn.changeVal=function(a){return $(this).val(a).trigger("change")},$.fn.childrenHeight=function(a,b,c){var d=bottomOffset=0;"undefined"==typeof a&&(a=!0),"undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!0);var e=this.children();return c&&(e=e.filter(":visible")),e.each(function(c,e){var f=$(e),g=f.offset().top,h=g+(a?f.outerHeight(b):f.height());g<d&&(d=g),h>bottomOffset&&(bottomOffset=h)}),bottomOffset-d-this.offset().top},$.fn.dataAttrConfig=function(a){a||(a="data-");var b=a.length,c=this.attrStartsWith(a),d={};return $.each(c,function(a,c){$.attrsToObject(a.substr(b),c,d)}),d},$.fn.findExclude=function(a,b,c){var d=$([]);return $(this).each(function(e,f){$(f).find(a).each(function(a,e){var g=$(e);c&&(g=g.parent());var h=g.closest(b);h[0]!=f&&h.length||(d=d.add(e))})}),d},$.fn.hasHorizontalScrollBar=function(){return!!this.get(0)&&this.get(0).scrollWidth>this.innerWidth()},$.fn.hasVerticalScrollBar=function(){return!!this.get(0)&&this.get(0).scrollHeight>this.innerHeight()},function(){var a={"nth-level":function(a,b){b=parseInt(b,10);var c=[],d=this;return this.each(function(){b+$(this).parents(a).length;d.find(a).each(function(){$(this).parents(a).length==b-1&&c.push(this)})}),$(c)}};$.fn.findOrig=$.fn.find,$.fn.find=function(b){if("string"==typeof b){var c,d=this;if($.each(a,function(e,f){var g=b.indexOf(":"+e);if(g!==-1){var h=e.length,i=b.substr(0,g),j=b.substr(g+h+2,b.length-g-h-3);return c=a[e].call(d,i,j),!1}}),c)return c}return this.findOrig(b)}}(),$.on=function(a,b,c){return $(document).on(a,b,c)},$.off=function(a,b,c){return $(document).off(a,b,c)},$.one=function(a,b,c){return $(document).one(a,b,c)},$.extend($.expr[":"],{scrollable:function(a){var b,c;return"scroll"==$(a).css("overflow")||"scroll"==$(a).css("overflowX")||"scroll"==$(a).css("overflowY")||((b=a.clientHeight<a.scrollHeight&&($.inArray($(a).css("overflowY"),["scroll","auto"])!=-1||$.inArray($(a).css("overflow"),["scroll","auto"])!=-1))||(c=a.clientWidth<a.scrollWidth&&($.inArray($(a).css("overflowX"),["scroll","auto"])!=-1||$.inArray($(a).css("overflow"),["scroll","auto"])!=-1)))},parents:function(a,b,c){return $(a).parents(c[3]).length<1},attrStartsWith:function(a,b,c){for(var d=0,e=a.attributes,f=e.length;d<f;d++)if(0===e[d].nodeName.toLowerCase().indexOf(c[3].toLowerCase()))return!0;return!1},attrEndsWith:function(a,b,c){for(var d=0,e=a.attributes,f=e.length;d<f;d++){var g=e[d].nodeName.toLowerCase(),h=c[3].toLowerCase();if(g.length>=h.length&&g.substr(g.length-h.length)===h)return!0}return!1}}),$.fn.removeClassPrefix=function(a){return this.each(function(b,c){var d=c.className.split(" ").filter(function(b){return 0!==b.lastIndexOf(a,0)});c.className=$.trim(d.join(" "))}),this},$.fn.requiredId=function(){var a=this.attr("id");return this.length>1?this.each(function(){$(this).requiredId()}):(a||(a=jstack.uniqid("uid-"),this.attr("id",a)),a)},$.fn.reverse=function(){return $(this.get().reverse())},$.fn.setVal=$.fn.val,$.fn.val=function(){var a=$.fn.setVal.apply(this,arguments);return arguments.length&&this.trigger("val"),a},$.fn.populateInput=function(a,b){b=$.extend({addMissing:!1,preventValEvent:!1},b);var c;c=b.preventValEvent?function(a,b){a.setVal(b)}:function(a,b){a.val(b)};var d=function(a,d){var e=!1;return a.hasClass("select2-hidden-accessible")?(c(a,d),void(b.preventValEvent||a.trigger("change"))):a[0].hasAttribute("data-preselect")?void a.attr("data-preselect",d):($("option",a).each(function(){$(this).val()==d&&($(this).prop("selected",!0),e=!0)}),void(!e&&b.addMissing&&(a.append('<option value="'+d+'" selected="selected">'+d+"</option>"),$(this).prop("selected",!0))))};return this.each(function(){var b=$(this);if(!b.data("j:populate:prevent"))if(b.is("select"))if(a instanceof Array)for(var e=0,f=a.length;e<f;e++)d(b,a[e]);else d(b,a);else if(b.is("textarea"))c(b,a);else switch(b.attr("type")){case"file":return;default:case"number":case"range":case"email":case"data":case"text":case"hidden":c(b,a);break;case"radio":b.length>=1&&$.each(b,function(b){var c=$(this).attr("value");singleVal=a;c===a?$(this).prop("checked",!0):$(this).prop("checked",!1)});break;case"checkbox":b.length>1?$.each(b,function(b){for(var c,d=$(this).attr("value"),e=void 0,f=0;f<a.length;f++)c=a[f],c===d&&(e=c);e?$(this).prop("checked",!0):$(this).prop("checked",!1)}):1==b.length&&($ctrl=b,a?$ctrl.prop("checked",!0):$ctrl.prop("checked",!1))}})},$.fn.populateForm=function(a,b){b=$.extend({addMissing:!1,not:!1,notContainer:!1},b);var c=this,d=function(a,d){null===d&&(d="");var e=c.find('[name="'+a+'"]');b.addMissing&&!e.length&&c.append('<input type="hidden" name="'+a+'" value="'+d+'">'),e.each(function(){var a=$(this);b.not&&a.is(b.not)||b.notContainer&&a.closest(b.notContainer).length||a.populateInput(d,b)})},e=function(a,b){$.each(b,function(b,c){var f=a+"["+b+"]";"object"==typeof c&&null!=c?e(f,c):d(f,c)})};return $.each(a,function(a,b){"object"==typeof b&&null!=b?e(a,b):d(a,b)}),this},$.fn.populate=function(a,b){return this.each(function(){var c=$(this);c.is("form")?c.populateForm(a,b):c.populateInput(a,b)})},$.fn.populateReset=function(){return this.each(function(){var a=$(this);if(a.is("form"))a.find(":input[name]").populateReset();else{var b=a.prop("type");"checkbox"==b||"radio"==b?a.prop("checked",this.defaultChecked):a.populateInput(this.defaultValue,{preventValEvent:!0}),a.trigger("input")}})},jstack.template={},jstack.template.templateVarSubstitutions={},function(w,j){var separatorStart="<%",separatorEnd="%>",separatorStartE="<%",separatorEndE="%>",cache={},reg1=eval("/'(?=[^"+separatorEndE+"]*"+separatorEndE+")/g"),reg2=eval("/"+separatorStartE+"=(.+?)"+separatorEndE+"/g");j.template.parse=function(a,b,c){var d;if(c&&cache[c])d=cache[c];else{var e=j.template.templateVarSubstitutions;a=a.html();for(var f in e)e.hasOwnProperty(f)&&(a=a.replace(new RegExp(f,"g"),separatorStart+e[f]+separatorEnd));var g=jstack.config.debug?"console.log(tmplException.message);":"",h="var tmplString=''; with(tmplObj){ tmplString += '"+a.replace(/[\r\t\n]/g," ").replace(reg1,"\t").split("'").join("\\'").split("\t").join("'").replace(reg2,"'; try{ tmplString += $1 }catch(tmplException){ "+g+" }; tmplString += '").split(separatorStart).join("';").split(separatorEnd).join("tmplString += '")+"';} return tmplString;";try{d=new Function("tmplObj",h),c&&(cache[c]=d)}catch(i){jstack.config.debug&&(console.log(i),console.log(h),console.log(a))}}return b?d(b):d}}(window,jstack),jstack.template.compile=function(a,b,c){var d=$.Deferred();return $.when.apply($,jstack.template.directiveCompile(a,c)).then(function(){var c=function(c){return jstack.template.directiveCompileLoaded($("<tmpl>"+jstack.template.parse(a,c,b)+"</tmpl>")).contents()};d.resolve(c)}),d},jstack.template.directives={},jstack.template.directive=function(a,b){return b&&(jstack.template.directives[a]=b),jstack.template.directives[a]},jstack.template.directiveCompileLoaded=function(a){return a.find("*").each(function(){var a=$(this);$.each(this.attributes,function(){var b=this.name;"j-loaded-"==b.substr(0,9)&&(a.attr(b.substr(9),this.value),a.removeAttr(b))})}),a},jstack.template.directiveCompile=function(a,b){var c=[];return $.each(jstack.template.directives,function(d,e){a.find("[j-"+d+"],"+d+"[j]").each(function(){var a=this.tagName==d.toUpperCase(),f=$(this),g=a?f.attr("j"):f.attr("j-"+d),h=e(g,f,b);h&&c.push(h),a?(f.removeAttr("j"),h?h.then(function(){f.replaceWith(f.html())}):f.replaceWith(f.html())):f.removeAttr("j-"+d)})}),c},jstack.template.jmlInject=function(a,b,c){return a.each(function(){var a=$(this),d=jstack.uniqid("tmpl");jstack.template.templateVarSubstitutions[d]=c,a[b](d)})},jstack.template.directive("foreach",function(a,b){var c;a.indexOf(" as ")!==-1?(c=a.split(" as "),jstack.template.jmlInject(b,"before","$.each("+c[0]+", function(i,"+c[1]+"){")):(c=a.split(" in "),jstack.template.jmlInject(b,"before","$.each("+c[1]+", function("+c[0]+"){")),jstack.template.jmlInject(b,"after","});")}),jstack.template.directive("href",function(a,b){href=jstack.route.baseLocation+"#"+a,b.attr("href",href)}),jstack.template.directive("src",function(a,b){b.attr("j-loaded-src",a)}),jstack.template.directive("include",function(a,b,c){var d=a.split(".").pop(),e=c+a;"jml"!=d&&(e+=".jml");var f=$.Deferred();return jstack.template.get(e).then(function(a){var d=$("<tmpl>"+a+"</tmpl>");$.when.apply($,jstack.template.directiveCompile(d,c)).then(function(){b.html(d.contents()),f.resolve()})}),f}),jstack.template.directive("extend",function(a,b,c){var d=c+a,e=a.split(".").pop();"jml"!=e&&"xjml"!=e&&(d+=".xjml");var f=$.Deferred();return jstack.template.get(d).then(function(a){var d=$("<tmpl>"+a+"</tmpl>");$.when.apply($,jstack.template.directiveCompile(d,c)).then(function(){b.find(">*").each(function(){var a=$(this),b=a.attr("selector");b||(b=a.attr("j"));var c=this.tagName.toLowerCase(),e=a.contents(),f=d.find(b);e.length?f[c](a.contents()):f[c]()}),b.replaceWith(d.contents()),f.resolve()})}),f}),function(){var a={},b={};jstack.template.get=function(c){if(!b[c]){if($js.dev){var d=(new Date).getTime().toString(),e=c;e.indexOf("_t=")===-1&&(e+=(e.indexOf("?")<0?"?":"&")+"_t="+d)}b[c]=$.Deferred(),$.ajax({url:e,cache:!0,success:function(d){for(var e={},f="",g=d.split("<%"),h=0,i=g.length;h<i;h++)if(h)for(var j=g[h].split("%>"),k=0,l=j.length;k<l;k++)if(k%2)f+=j[k];else{var m=jstack.uniqid("tmpl");f+=m,e[m]=j[k]}else f+=g[h];$.extend(jstack.template.templateVarSubstitutions,e),a[c]=f,b[c].resolve(a[c],c)}})}return b[c]}}(),jstack.jml=function(a,b){var c=a,d=$.Deferred(),e=a.split("/");return e.pop(),e=e.join("/")+"/",e=jstack.config.templatesPath+e,a=jstack.config.templatesPath+a,b||(b={}),jstack.template.get(a).then(function(a){var f=$("<tmpl>"+a+"</tmpl>");jstack.template.compile(f,c,e).then(function(a){d.resolve(a(b))})}),d},function(){jstack.component={};var a=function(){var a=this,b=$(a).attr("j-component"),c=$(a).dataAttrConfig("j-data-"),d=$(a).attr("j-params-data"),e=function(){var e,f=jstack.component[b];if(d){var g=[];g.push(a),e=new(Function.prototype.bind.apply(f,g))}else e=new f(a,c);$(a).data("j:component",e)};jstack.component[b]?e():$js("jstack."+b,e)},b=function(){var a=this,b=$(a).attr("jquery-component"),c=$(a).dataAttrConfig("j-data-"),d=$(a).attr("j-params-data"),e=[];if(d){var f=[];for(var g in c)c.hasOwnProperty(g)&&f.push(g);f.sort();for(var h=0,i=f.length;h<i;h++)e.push(c[f[h]])}else $.isEmptyObject(c)||e.push(c);var j=function(){$(a).data("j:component",$.fn[b].apply($(a),e))};$.fn[b]?j():$js("jstack.jquery."+b,j)};$.on("j:load","[j-component]",a),$.on("j:load","[jquery-component]",b),$.on("j:unload","[j-component]",function(){var a=$(this).data("j:component");a&&"function"==typeof a.unload&&a.unload()}),$("[j-component]").each(function(){$(this).data("j:component")||a.call(this)}),$("[jquery-component]").each(function(){$(this).data("j:component")||b.call(this)}),jstack.loader=function(a,b,c){$.on("j:load",a,function(){b.call(this)}),"function"==typeof c&&$.on("j:unload",a,function(){c.call(this)}),$(a).each(function(){b.call(this)})},jstack.preloader={":input[name]":function(){jstack.dataBinder.inputToModel(this,"j:default",!0)}}}(),jstack.route=function(a,b){var c=[],d={},e=function(a,b){this.name=b,this.path=a,this.keys=[],this.fns=[],this.params={},this.regex=f(this.path,this.keys,!1,!1)};e.prototype.addHandler=function(a){this.fns.push(a)},e.prototype.removeHandler=function(a){for(var b=0,c=this.fns.length;b<c;b++){var d=this.fns[b];if(a==d)return void this.fns.splice(b,1)}},e.prototype.run=function(a){for(var b=0,c=this.fns.length;b<c;b++)this.fns[b].apply(this,a)},e.prototype.match=function(a,b){var c=this.regex.exec(a);if(!c)return!1;for(var d=1,e=c.length;d<e;++d){var f=this.keys[d-1],g="string"==typeof c[d]?decodeURIComponent(c[d]):c[d];f&&(this.params[f.name]=g),b.push(g)}return!0},e.prototype.toURL=function(a){var b=this.path;for(var c in a)b=b.replace("/:"+c,"/"+a[c]);if(b=b.replace(/\/:.*\?/g,"/").replace(/\?/g,""),b.indexOf(":")!=-1)throw new Error("missing parameters for url: "+b);return b};var f=function(a,b,c,d){return a instanceof RegExp?a:(a instanceof Array&&(a="("+a.join("|")+")"),a=a.concat(d?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+a+"$",c?"":"i"))},g=function(a,b){var f=a.split(" "),g=2==f.length?f[0]:null;a=2==f.length?f[1]:f[0],d[a]||(d[a]=new e(a,g),c.push(d[a])),d[a].addHandler(b)},h=function(a,c,d){if("function"==typeof c)g(a,c);else if("object"==typeof a)for(var e in a)g(e,a[e]);else if("undefined"==typeof c)h.navigate(a);else if("object"==typeof c){var f={};d&&$.extend(f,v()),$.extend(f,b.getParams(a),c);var i=b.buildQuery(f);i&&(i="?"+i),a=b.getPath(a),h.navigate(a+i)}};h.lookup=function(a,b){for(var d=0,e=c.length;d<e;d++){var f=c[d];if(f.name==a)return f.toURL(b)}},h.remove=function(a,b){var c=d[a];c&&c.removeHandler(b)},h.removeAll=function(){d={},c=[]},h.navigate=function(b,c){c=c||{};var d=c.silent||!1;d&&s(),setTimeout(function(){a.location.hash=b,d&&setTimeout(function(){r()},1)},1)};var i=function(){var b="",c=a.location.hash.substring(1),d=c.indexOf("#");return d!==-1&&(b=c.substr(d+1)),b},j=function(){var b=a.location.hash.substring(1),c=b.indexOf("#");return c!==-1&&(b=b.substr(0,c)),b},k=function(a,b){var c=[];return!!b.match(a,c)&&(b.run(c),!0)},l=function(a){for(var b=0,d=c.length;b<d;b++){var e=c[b];if(k(a,e))return}};h.load=l;var m,n=function(){var a=j();return a!=m?(m=a,$(document).trigger("j:route:load"),l(m)):void $(document).trigger("j:subroute:change")};h.reload=n;var o=function(b){var c=$(this),d=c.attr("href");if(d)return"/"+d==a.location.pathname?(b.preventDefault(),jstack.route(""),!1):void("##"==d.substr(0,2)&&(b.preventDefault(),q(d.substr(2))))},p=function(b){var c=b+"#"+i();a.location.hash=c},q=function(b){var c=m+"#"+b;a.location.hash=c},r=function(){a.addEventListener?a.addEventListener("hashchange",n,!1):a.attachEvent("onhashchange",n),$(document).on("click","a",o),h.reload()},s=function(){a.removeEventListener?a.removeEventListener("hashchange",n):a.detachEvent("onhashchange",n),$(document).off("click","a",o)};h.start=r,h.stop=s;var t=function(){return b.getQuery(j())},u=function(){return b.getPath(j())},v=function(){return b.getParams(j())},w=function(a){return v()[a]},x=function(){return b.getParams("?"+i())},y=function(a){return x()[a]};h.getHash=j,h.getHash2=i,h.getParams=v,h.getParam=w,h.getSubParams=x,h.getSubParam=y,h.getQuery=t,h.getPath=u,h.setMainHash=p,h.setSubHash=q;var z=document.getElementsByTagName("base")[0];if(z)h.baseHref=z.href;else{var A=window.location,B=A.pathname;B=B.split("/"),B.pop(),B=B.join("/")||"/";var C,D=A.username?A.username+(A.password?":"+A.password:"")+"@":"";C=A.port&&("https"==A.protocol&&"443"!=A.port||"80"!=A.port)?":"+A.port:"",h.baseHref=A.protocol+"//"+D+A.host+C+B}var E=a.location.href;E=E.split("/"),E=E[0]+"//"+E[2],E=h.baseHref.substr(E.length),h.basePath=E;var F=a.location.href.substr(h.baseHref.length),G=F.indexOf("#");return G>-1&&(F=F.substr(0,G)),h.baseLocation=F,h}(window,jstack.url),jstack.dataBinder=function(){var a=function(){this.updateWait=100};a.prototype={dotGet:function(a,b,c){return a.split(".").reduce(function(a,b){return"object"==typeof a&&null!==a&&"undefined"!=typeof a[b]?a[b]:c},b)},dotSet:function(a,b,c,d){if("object"==typeof b)return a.split(".").reduce(function(a,b,e,f){return f.length!=e+1?("object"!=typeof a[b]&&(a[b]={}),a[b]):(d&&a[b]&&(c=a[b]),void(d&&a[b]||(a[b]=c)))},b),c},dotDel:function(a,b,c){a.split(".").reduce(function(a,b,c,d){if("object"==typeof a)return d.length!=c+1?a[b]:void("undefined"!=typeof a[b]&&delete a[b])},b)},getKey:function(a){return a.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"")},getValue:function(a,b,c){var d=this,e=d.getControllerData(a),f=d.getScoped(a,b);return d.dotGet(f,e,c)},getValueEval:function(a,b,c){var d=this,e=d.getScopeValue(a);"undefined"==typeof b?b="undefined":null===b?b="null":""==b.trim()?b="undefined":(b=b.replace(/[\r\t\n]/g,""),b=b.replace(/(?:^|\b)(this)(?=\b|$)/g,"$this"));var f,g=jstack.config.debug?"console.log(jstackException.message);":"",h=new Function("$scope, $controller, $this, $default, $parent","try{ with($scope){var $return = "+b+"; return typeof($return)=='undefined'?$default:$return;} }catch(jstackException){"+g+"}"),i=d.getControllerData(a);return f=function(b){b||(b=1),b+=1;for(var c=a,e=0;e<b;e++)c=d.getParentScope(c);var f=d.getScopeValue(c);return f},h(e,i,a,c,f)},getAttrValueEval:function(a,b,c){var d=this,e=$(a).attr(b);return d.getValueEval(a,e,c)},getAttrValue:function(a,b,c){var d=this,e=$(a).attr(b);return d.getValue(a,e,c)},getScopeValue:function(a){var b=this,c=$(a).closest("[j-scope]");return c.length?b.getAttrValue(c,"j-scope",{}):b.getControllerData(a)},getScope:function(a){return $(a).parents("[j-scope]").map(function(){return $(this).attr("j-scope")}).get().reverse().join(".")},getScopedInput:function(a){var b=$(a).attr("name"),c=this.getKey(b);return this.getScoped(a,c)},getScoped:function(a,b){if("."===b.substr(0,1))return b.substr(1);var c=this.getScope(a);return c&&(c+="."),c+=b},getters:{SELECT:function(a){return $(a).val()},INPUT:function(a){var b=$(a).prop("type");return"checkbox"==b||"radio"==b?$(a).prop("checked")?$(a).val():null:"file"==b?a.files:"submit"!=b?$(a).val():void 0},TEXTAREA:function(a){return $(a).val()}},defaultGetter:function(a){return $(a).html()},getInputVal:function(a){var b=a.tagName,c=this.getters[b]||this.defaultGetter;return c(a)},modelToInput:function(a){var b=this;a=$(a),a.find(":input[name]").each(function(){var a=$(this);if(!a.closest("[j-unscope]").length){var c=b.getInputVal(this),d=b.getAttrValue(this,"name",c);a.data("j:populate:prevent")||(a.populateInput(d,{preventValEvent:!0}),a.trigger("j:val",[d]))}}),a.find(":input[j-val]").each(function(){var a=$(this),c=a.prop("type"),d=b.getAttrValueEval(this,"j-val"),e=a.attr("name");if("undefined"==typeof d){var f;f="checkbox"==c||"radio"==c?this.defaultChecked:this.defaultValue,d=f}e&&b.dotSet(b.getKey(e),b.getScopeValue(this),d),a.data("j:populate:prevent")||(a.populateInput(d,{preventValEvent:!0}),a.trigger("j:val",[d]))}),a.find("[j-var]").each(function(){var a=b.getAttrValueEval(this,"j-var");$(this).html(a)}),a.find(':attrStartsWith("j-var-")').each(function(){var a=$(this),c=a.attrStartsWith("j-var-");$.each(c,function(c,d){var e=d.match(/\${\s*[\w\.]+\s*}/g);e&&$.each(e,function(c,e){var f=e.match(/[\w\.]+/)[0],g=b.getValue(a.get(0),f);"undefined"!=typeof g&&null!==g&&g||(g=""),d=d.replace(new RegExp("\\$\\{"+f+"\\}","g"),g)}),a.attr(c.substr(6),d)})})},inputToModel:function(a,b,c){var d=$(a);if(!d.closest("[j-unscope]").length){var e=this,f=e.getControllerData(a),g=(d.attr("name"),function(g){var h=e.getScopedInput(a);g=e.dotSet(h,f,g,c),i!=g&&(g=i,d.populateInput(g,{preventValEvent:!0}));var j=$.Deferred();e.triggerUpdate(j),j.then(function(){d.trigger(b,[g])})}),h=e.getInputVal(a),i=e.filter(a,h);return"object"==typeof i&&null!==i&&"function"==typeof i.promise?void i.then(function(a){g(a)}):void g(i)}},observer:null,stateObserver:!0,triggerMutationsLoad:function(a){var b=$._data(document,"events"),c=b["j:load"]||[],d=$.Event("j:load");$.each(a.load,function(a,b){$.each(c,function(a,c){c.selector&&$(b).is(c.selector)&&c.handler.call(b,d)})});var e=b["j:unload"]||[],f=$.Event("j:unload");$.each(a.unload,function(a,b){$.each(e,function(a,c){c.selector&&$(b).is(c.selector)&&c.handler.call(b,f)})})},eventListener:function(){var a=this,b=function(a){if(a.nodeType==Node.TEXT_NODE&&a instanceof Text)return!1;var b=$(a);return!b.attr("j-repeat")&&!b.closest("[j-repeat]").length};a.observer=new MutationObserver(function(c){var d={load:[],unload:[]};if($.each(c,function(a,c){$.each(c.addedNodes,function(a,c){var e=$(c).add($(c).find("*"));e.each(function(a,c){b(c)&&d.load.push(c)})}),$.each(c.removedNodes,function(a,c){var e=$(c).add($(c).find("*"));e.each(function(a,c){b(c)&&d.unload.push(c)})})}),d.load.length||d.unload.length){$.each(d.load,function(a,b){$.each(jstack.preloader,function(a,c){$(b).is(a)&&c.call(b)})});var e=$.Deferred();a.stateObserver&&a.triggerUpdate(e),e.then(function(){a.triggerMutationsLoad(d)})}}),a.observer.observe(document,{subtree:!0,childList:!0,attribute:!1,characterData:!0}),$(document.body).on("input",":input[name]",function(b){a.inputToModel(this,"j:input")}),$(document.body).on("val",":input[name][j-val-event]",function(b){a.inputToModel(this,"j:input")}),$(document.body).on("j:update",":input[name]",function(b){$(this).data("j:populate:prevent",!0),a.inputToModel(this,"j:input"),$(this).one("j:input",function(){$(this).data("j:populate:prevent",!1)})})},filter:function(a,b){var c=this,d=c.getFilter(a);return"function"==typeof d&&(b=d(b)),b},getFilter:function(a){var b=this;a=$(a);var c=a.data("j-filter");if(!c){var d=a.attr("j-filter");if(d){var e=b.getValue(a,d);a.data("j-filter",e)}}return c},getControllerData:function(a){return this.getController(a).data("jModel")},getParentScope:function(a){var b=$(a).parent().closest("[j-scope]");return b.length||(b=this.getController(a)),b},getController:function(a){var b=$(a).closest("[j-controller]");return b.length||(b=$(document.body),b.attr("j-controller",""),b.data("jModel")||b.data("jModel",{})),b},updateDefers:[],updateDeferStateObserver:null,updateTimeout:null,triggerUpdate:function(a){var b=this;b.updateTimeout&&clearTimeout(b.updateTimeout),a&&b.updateDefers.push(a),b.updateTimeout=setTimeout(function(){if(b.updateDeferStateObserver)return void b.updateDeferStateObserver.then(function(){b.triggerUpdate()});for(b.updateDeferStateObserver=$.Deferred(),b.stateObserver=!1,b.update();b.updateDefers.length;)b.updateDefers.pop().resolve();b.updateDeferStateObserver.resolve(),b.updateDeferStateObserver=!1,b.stateObserver=!0},b.updateWait)},update:function(){var a=this;a.updateRepeat(),a.updateIf(),a.updateController(),a.updateOn()},updateOn:function(){var a=this;$(':attrStartsWith("j-on-")').each(function(){var b=$(this),c=b.attrStartsWith("j-on-");$.each(c,function(c,d){var e=c.substr(5);b.removeAttr(c),b.on(e,function(){var c=a.getValue(b,d);if("function"==typeof c){var e=c.apply(this,arguments);return e!==!1&&void(e&&$.when(e).then(function(){a.triggerUpdate()}))}})})})},updateController:function(){var a=this;$("[j-controller]").each(function(){a.modelToInput(this)})},updateIf:function(){var a=this;$("[j-if]").each(function(){var b=$(this),c=a.getAttrValueEval(this,"j-if"),d=b.data("jIf");"undefined"==typeof d&&(d=b.contents(),b.data("jIf",d));var e=b.data("jIfState");if("undefined"==typeof e)e=c,b.data("jIfState",e);else if(Boolean(e)===Boolean(c))return;c?(d.appendTo(b),b.trigger("j-if:true")):(d.detach(),b.trigger("j-if:false"))})},updateRepeat:function(){var a=this;$("[j-repeat]").each(function(){var a=$(this),b=a.parent();b.attr("j-repeat-list","true");var c=b.data("jRepeatList")||[];c.push(this),b.data("jRepeatList",c),a.detach()}),$("[j-repeat-list]").each(function(){var b=$(this),c=b.data("jRepeatList")||[],d=[];$.each(c,function(c,e){var f=$(e),g=f.attr("j-repeat"),h=a.getValueEval(b.get(0),g),c=1;$.each(h,function(a,e){var h=g+"."+a,i=b.children('[j-scope="'+h+'"]');i.length||(i=f.clone(),i.removeAttr("j-repeat"),i.attr("j-scope",h),i.attr("j-scope-id",a),i.appendTo(b)),i.find("[j-index]").text(c),d.push(h),c++})}),b.children("[j-scope]").each(function(){var a=$(this).attr("j-scope");d.indexOf(a)===-1&&$(this).remove()})})}};var b=new a;return b.eventListener(),b}(),$.on("reset","form[j-scope]",function(){$(this).populateReset()}),function(a,b){var c=function(a,b){var c=a[b];return c!==Object[b]&&c!==Object.__proto__[b]&&c!==Array[b]&&c!==Array.__proto__[b]},d=function(b){for(var c=[],d=a.param(b).split("&"),e=0;e<d.length;e++){var f=d[e].split("="),g=null!==f[1]?decodeURIComponent(f[1]):"";c.push([decodeURIComponent(f[0]),g])}return c},e=function(b,c,d,f){d||(d="");for(var g in b)if(b.hasOwnProperty(g)){var h=d+g,i=b[g];if(i instanceof FileList){if(1==i.length)c[h]=i[0];else{c[h]=[];for(var j=0;j<i.length;j++)c[h].push(i[j])}delete b[g]}else i instanceof a?b[g]=i.jsonml():i instanceof HTMLCollection||i instanceof HTMLElement?b[g]=a(i).jsonml():"object"==typeof i&&e(i,c,h+"_",f+1)}},f=function(a){for(var b in a)c(a,b)&&("undefined"==typeof a[b]||null===a[b]?a[b]="":"object"==typeof a[b]&&(a[b]=f(a[b])));return a};b.ajax=function(){var b,c={};if(2==arguments.length?(b=arguments[1]||{},b.url=arguments[0]):b=arguments[0],b.data&&e(b.data,c),!a.isEmptyObject(c)){for(var g,h=new FormData,i=d(b.data),j=0;j<i.length;j++)h.append(i[j][0],i[j][1]);for(var k in c)if(c.hasOwnProperty(k)){var l=c[k];if(l instanceof Array)for(var j=0;j<l.length;j++)"undefined"!=typeof l[j]&&(h.append(k+"[]",l[j]),g=!0);else"undefined"!=typeof l&&(h.append(k,l),g=!0)}g&&(b.type="POST",b.processData=!1,b.contentType=!1,b.data=h)}return b.data=f(b.data),a.ajax(b)},b.post=function(a,c,d,e){return b.ajax({type:"POST",url:a,data:c,success:d,dataType:e})}}(jQuery,jstack),jstack.mvc=function(a){"string"==typeof arguments[0]&&(a={view:arguments[0],controller:"string"==typeof arguments[1]?arguments[1]:arguments[0]}),a.controller||(a.controller=a.view),a.target||(a.target=jstack.config.defaultTarget);var b,c,d=jstack.config.templatesPath,e=d+a.view+".jml",f=jstack.config.controllersPath+a.controller,g=$.Deferred(),h=$.Deferred();jstack.controllers[a.controller]?g.resolve():$js.onExists(f,g.resolve,g.resolve),jstack.template.get(e).then(function(e){var e=$("<tmpl>"+e+"</tmpl>");e.find("> *").length||e.wrapInner("<div />"),c=e.children(0),c.attr("j-controller",a.controller);var f=a.view+"#"+a.controller;jstack.template.compile(c,f,d).then(function(a){b=function(b){var d=a(b);c.data("jModel",b),c.html(d)},h.resolve()})});var i=$.Deferred();return $.when(g,h).then(function(){var d=jstack.controller(a.controller);
d||(d=jstack.controller(a.controller,jstack.config.defaultController)),d.jstack.render=function(e,f){f||(f=a.target),e||(e={}),"object"==typeof a.data&&null!==a.data&&(e=$.extend({},a.data,e)),d.jstack.data=e;b(d.jstack.data);return $(f).html(c),i.resolve(c,d),e},d.jstack.element=c,d()}),i},jstack.viewReady=function(a){if("string"==typeof arguments[0]){var b='[j-view="'+arguments[0]+'"]';a=$(arguments[1]).find(b)}a=$(a);var c=a.data("jViewReady");return c||(c=$.Deferred(),a.data("jViewReady",c)),c},$.on("j:load","[j-view]",function(){var a=$(this),b=a.attr("j-view"),c=a.attr("j-controller")||b,d=a.parent().closest("[j-controller]"),e=!!d.length&&d.data("jModel"),f=jstack.viewReady(this),g=jstack.mvc({view:b,controller:c,target:this,data:e});g.then(function(){f.resolve()})}),function(){jstack.app=function(a,b){b||(b=a.attr("j-app")),jstack.config.templatesPath+=b+"/",jstack.config.controllersPath+=b+"/",jstack.route("*",function(a){a=jstack.url.getPath(a),jstack.mvc(a).then(function(){$(document).trigger("j:route:loaded")})})};var a=$("[j-app]");a.length&&jstack.app(a)}();